<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Outside Creative Module - Updated</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    .hidden { display: none; }
    label { display: block; margin: 10px 0 5px; }
    input, select { padding: 5px; width: 300px; max-width: 100%; }
    .error { color: red; margin-top: 5px; }
    .success { color: green; }
    button { padding: 8px 12px; margin-top: 10px; }
    .suggestions { border: 1px solid #ccc; max-height: 100px; overflow-y: auto; position: absolute; background: #fff; width: 300px; }
    .suggestion-item { padding: 5px; cursor: pointer; }
    .suggestion-item:hover { background: #eee; }
  </style>
</head>
<body>

  <h1>Outside Creative Module</h1>

  <!-- Step 1: File Upload -->
  <div id="file-upload-section">
    <h2>Step 1: Upload File</h2>
    <input type="file" id="fileInput" accept=".mp4,.mov">
    <div id="file-error" class="error"></div>
    <button id="uploadButton">Upload File</button>
  </div>

  <!-- Step 2: Metadata Form -->
  <div id="metadata-section" class="hidden">
    <h2>Step 2: Enter Metadata</h2>
    <!-- Display pre-generated UUID -->
    <div>
      <strong>Submission ID (UUID):</strong> <span id="uuidDisplay"></span>
    </div>
    <form id="metadataForm">
      <!-- Title Field (New) -->
      <label for="titleText">Title:</label>
      <input type="text" id="titleText" placeholder="Enter Title" required>
      
      <!-- Language Field (as per previous update) -->
      <label for="language">Language:</label>
      <select id="language" required>
        <option value="">--Select Language--</option>
        <option value="English">English</option>
        <option value="French">French</option>
      </select>

      <!-- Duration Field (New) -->
      <label for="duration">Duration (seconds):</label>
      <select id="duration" required>
        <option value="">--Select Duration--</option>
        <option value="5">5</option>
        <option value="10">10</option>
        <option value="15">15</option>
        <option value="30">30</option>
        <option value="60">60</option>
      </select>

      <!-- Advertise: Searchable field -->
      <label for="advertise">Advertise:</label>
      <input type="text" id="advertise" autocomplete="off" placeholder="Type to search..." required>
      <div id="advertise-suggestions" class="suggestions hidden"></div>

      <!-- Server Endpoint: Multiple Selection -->
      <label for="serverEndpoint">Server Endpoint:</label>
      <select id="serverEndpoint" multiple required>
        <option value="FW">FW</option>
        <option value="Cadent">Cadent</option>
        <option value="GAM">GAM</option>
        <option value="Reogers">Reogers</option>
        <option value="Telus">Telus</option>
        <option value="ALL">ALL</option>
      </select>

      <label for="industry">Industry:</label>
      <select id="industry" required>
        <option value="">--Select Industry--</option>
        <option value="Cadent">Cadent</option>
        <option value="FW">FW</option>
      </select>

      <!-- Dynamic Sub-Industry Field -->
      <div id="subIndustryContainer" class="hidden">
        <label for="subIndustry">Sub-Industry:</label>
        <input type="text" id="subIndustry" autocomplete="off" placeholder="Type to search..." required>
        <div id="subIndustry-suggestions" class="suggestions hidden"></div>
      </div>

      <label>Content Type:</label>
      <input type="radio" id="vod" name="contentType" value="VOD" required>
      <label for="vod" style="display: inline;">VOD</label>
      <input type="radio" id="linear" name="contentType" value="Linear">
      <label for="linear" style="display: inline;">Linear</label>

      <br><br>
      <button type="submit">Submit Metadata</button>
    </form>
  </div>

  <!-- Confirmation Message -->
  <div id="confirmation" class="hidden">
    <h2>Submission Successful</h2>
    <p id="confirmationMessage"></p>
  </div>

  <script>
    /***** Simulated Data *****/
    const advertisers = ["Advertiser A", "Advertiser B", "Advertiser C", "Alpha Advertising", "Beta Media"];

    /***** Utility: UUID Generation *****/
    function generateUUID() {
      var d = new Date().getTime();
      var d2 = (performance && performance.now && (performance.now() * 1000)) || 0;
      return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
          var r = Math.random() * 16;
          if (d > 0) {
              r = (d + r) % 16 | 0;
              d = Math.floor(d / 16);
          } else {
              r = (d2 + r) % 16 | 0;
              d2 = Math.floor(d2 / 16);
          }
          return (c === 'x' ? r : (r & 0x3 | 0x8)).toString(16);
      });
    }

    /***** File Upload Handling *****/
    const fileInput = document.getElementById("fileInput");
    const uploadButton = document.getElementById("uploadButton");
    const fileErrorDiv = document.getElementById("file-error");
    const metadataSection = document.getElementById("metadata-section");
    let generatedUUID = '';

    uploadButton.addEventListener("click", function() {
      const file = fileInput.files[0];
      if (!file) {
        fileErrorDiv.textContent = "Please select a file.";
        return;
      }

      // Validate file type (only mp4 or mov)
      const validExtensions = ["mp4", "mov"];
      const fileName = file.name.toLowerCase();
      const fileExtension = fileName.split('.').pop();

      if (!validExtensions.includes(fileExtension)) {
        fileErrorDiv.textContent = "Invalid file type. Please upload an MP4 or MOV file.";
        return;
      }

      // Clear error and generate UUID immediately
      fileErrorDiv.textContent = "";
      generatedUUID = generateUUID();
      document.getElementById("uuidDisplay").textContent = generatedUUID;

      // Transition to metadata form
      document.getElementById("file-upload-section").classList.add("hidden");
      metadataSection.classList.remove("hidden");
    });

    /***** Searchable Field Utility for Advertise *****/
    const advertiseInput = document.getElementById("advertise");
    const advertiseSuggestions = document.getElementById("advertise-suggestions");

    advertiseInput.addEventListener("input", function() {
      const query = advertiseInput.value.toLowerCase();
      const matches = advertisers.filter(ad => ad.toLowerCase().includes(query));
      renderSuggestions(matches, advertiseSuggestions, advertiseInput);
    });

    /***** Utility: Render Suggestions *****/
    function renderSuggestions(matches, container, inputElement) {
      container.innerHTML = "";
      if (matches.length === 0 || inputElement.value.trim() === "") {
        container.classList.add("hidden");
        return;
      }
      matches.forEach(match => {
        const div = document.createElement("div");
        div.textContent = match;
        div.classList.add("suggestion-item");
        div.addEventListener("click", function() {
          inputElement.value = match;
          container.classList.add("hidden");
        });
        container.appendChild(div);
      });
      container.classList.remove("hidden");
    }

    /***** Dynamic Sub-Industry Field for Outside Creative *****/
    const industrySelect = document.getElementById("industry");
    const subIndustryContainer = document.getElementById("subIndustryContainer");
    const subIndustryInput = document.getElementById("subIndustry");
    const subIndustrySuggestions = document.getElementById("subIndustry-suggestions");
    const subIndustryOptions = {
      "FW": ["FW Option 1", "FW Option 2", "FW Creative"],
      "Cadent": ["Cadent Option A", "Cadent Option B", "Cadent Media"]
    };

    industrySelect.addEventListener("change", function() {
      const selected = industrySelect.value;
      if (selected === "FW" || selected === "Cadent") {
        subIndustryContainer.classList.remove("hidden");
      } else {
        subIndustryContainer.classList.add("hidden");
        subIndustryInput.value = "";
        subIndustrySuggestions.classList.add("hidden");
      }
    });

    subIndustryInput.addEventListener("input", function() {
      const query = subIndustryInput.value.toLowerCase();
      const selected = industrySelect.value;
      const options = subIndustryOptions[selected] || [];
      const matches = options.filter(opt => opt.toLowerCase().includes(query));
      renderSuggestions(matches, subIndustrySuggestions, subIndustryInput);
    });

    /***** Metadata Submission Handling *****/
    const metadataForm = document.getElementById("metadataForm");
    metadataForm.addEventListener("submit", function(e) {
      e.preventDefault();

      // Collect form values
      const titleText = document.getElementById("titleText").value;
      const language = document.getElementById("language").value;
      const duration = document.getElementById("duration").value;
      const advertise = advertiseInput.value;
      // Get multiple selected server endpoints:
      const serverEndpointSelect = document.getElementById("serverEndpoint");
      const selectedServerEndpoints = Array.from(serverEndpointSelect.selectedOptions).map(option => option.value);
      const industry = industrySelect.value;
      const subIndustry = (!subIndustryContainer.classList.contains("hidden")) ? subIndustryInput.value : "";
      const contentType = document.querySelector('input[name="contentType"]:checked').value;

      // Simulate saving the file and metadata, and triggering the transcode process.
      console.log("Submission Details:", {
        uuid: generatedUUID,
        title: titleText,
        language,
        duration,
        advertise,
        serverEndpoint: selectedServerEndpoints,
        industry,
        subIndustry,
        contentType
      });
      console.log("Triggering vantage transcode for UUID:", generatedUUID);

      // Display confirmation message
      metadataSection.classList.add("hidden");
      const confirmationDiv = document.getElementById("confirmation");
      const confirmationMessage = document.getElementById("confirmationMessage");
      confirmationMessage.innerHTML = `
        File and metadata submitted successfully!<br>
        <strong>UUID:</strong> ${generatedUUID}<br>
        <strong>Title:</strong> ${titleText}<br>
        <strong>Language:</strong> ${language}<br>
        <strong>Duration:</strong> ${duration} seconds<br>
        <strong>Server Endpoints:</strong> ${selectedServerEndpoints.join(", ")}<br>
        The transcoding process has been initiated.
      `;
      confirmationDiv.classList.remove("hidden");
    });
  </script>

</body>
</html>